# Description

`dsk.py` is a simple Python 3.X-based tool for creating and managing DSK files, as used in simulators and disk drive emulators for Amstrad CPC computers. It can perform various operations to work with these files, with its main focus on aiding to package programs developed on modern computers.

Currently, it only supports the single-sided data format:
- 178 KB.
- 40 tracks with 9 sectors of 512 bytes each.
- Sectors numbered from 0xC1 to 0xC9.
- File table with 64 entries.

For more information on the format, refer to the following pages:
- [Amstrad CPC Emulator Documentation](http://www.benchmarko.de/cpcemu/cpcdoc/chapter/cpcdoc7_e.html#I_FILE_STRUCTURE)
- [CPCWiki - DSK Disk Image File Format](https://www.cpcwiki.eu/index.php/Format:DSK_disk_image_file_format)
- [Sinclair Wiki - DSK Format](https://sinclair.wiki.zxnet.co.uk/wiki/DSK_format)

This tool does not overwrite existing files with the same name inside the DSK; all operations add files. Therefore, you can combine the --new option with insertion operations, allowing you to generate the same DSK file every time the command is executed.

# Basic Usage

> python3 dsk.py <dskfile> [options]

## Available Options

- `--new`: Creates a new empty DSK file.
- `--check`: Checks if the DSK file format is compatible with the tool.
- `--dump`: Prints DSK file format information on the standard output.
- `--cat`: Lists the contents of the DSK file on the standard output.
- `--header <entry>`: Prints the AMSDOS header for the specified file entry (starting at 0).
- `--get <entry>`: Extracts the file pointed to by the specified entry (starting at 0).
- `--put-bin <file>`: Adds a new binary file to the DSK file, generating and appending an additional AMSDOS header.
- `--put-raw <file>`: Adds a new binary file to the DSK file without creating an additional AMSDOS header.
- `--put-ascii <file>`: Adds a new ASCII file to the DSK file. The file should not include an AMSDOS header.
- `--map-file <file>`: Imports a file generated by the ABASM assembler containing a list of symbols and their asociated memory addresses.
- `--load-addr <address>`: Initial address to load the file (default is 0x4000). Only used in binary files with generated AMSDOS headers.
- `--start-addr <address|symbol>`: Call address (default is 0x4000). Only used in binary files with generated AMSDOS headers. If a MAP file is specified, it's possible to indicate the address using a symbol included in that file.
- `--help`: Displays the help on the standard output.

## Usage Examples

Create a new DSK file with a BASIC program:

```
python3 dsk.py file.dsk --new --put-ascii program.bas
```

List the contents of the DSK file to verify that our program is included:

```
python3 dsk.py file.dsk --cat
```

Add a binary file to the DSK file which should be loaded and executed from address 0x4000:

```
python3 dsk.py --new file.dsk --put-bin program.bin --load-addr 0x4000 --start-addr 0x4000
```

Add a binary file to the DSK file which should be loaded at address 0x4000. It imports a MAP file called program.map that includes the symbol MAIN which is used to stablish the call address.

```
python3 dsk.py --new file.dsk --put-bin program.bin --map-file program.map --load-addr 0x4000 --start-addr MAIN
```
